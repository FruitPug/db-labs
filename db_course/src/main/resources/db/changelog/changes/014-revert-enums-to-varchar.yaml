databaseChangeLog:
  - changeSet:
      id: 014-revert-enums-to-varchar
      author: admin
      changes:
        - sql:
            dbms: postgresql
            sql: |
              ALTER TABLE users
                ALTER COLUMN role TYPE VARCHAR(50)
                USING role::text;

              ALTER TABLE users
                DROP CONSTRAINT IF EXISTS chk_users_role;

              ALTER TABLE users
                ADD CONSTRAINT chk_users_role
                  CHECK (role IN ('ADMIN', 'MANAGER', 'DEVELOPER'));

              ALTER TABLE projects
                ALTER COLUMN status TYPE VARCHAR(50)
                USING status::text;

              ALTER TABLE projects
                DROP CONSTRAINT IF EXISTS chk_projects_status;

              ALTER TABLE projects
                ADD CONSTRAINT chk_projects_status
                  CHECK (status IN ('ACTIVE', 'ARCHIVED', 'ON_HOLD'));

              ALTER TABLE project_members
                ALTER COLUMN role TYPE VARCHAR(50)
                USING role::text;

              ALTER TABLE project_members
                DROP CONSTRAINT IF EXISTS chk_project_members_role;

              ALTER TABLE project_members
                ADD CONSTRAINT chk_project_members_role
                  CHECK (role IN ('OWNER', 'MAINTAINER', 'CONTRIBUTOR', 'VIEWER'));

              ALTER TABLE tasks
                ALTER COLUMN status TYPE VARCHAR(50)
                USING status::text;

              ALTER TABLE tasks
                DROP CONSTRAINT IF EXISTS chk_tasks_status;

              ALTER TABLE tasks
                ADD CONSTRAINT chk_tasks_status
                  CHECK (status IN ('TODO', 'IN_PROGRESS', 'DONE', 'CANCELLED'));

              ALTER TABLE tasks
                ALTER COLUMN priority TYPE VARCHAR(50)
                USING priority::text;

              ALTER TABLE tasks
                DROP CONSTRAINT IF EXISTS chk_tasks_priority;

              ALTER TABLE tasks
                ADD CONSTRAINT chk_tasks_priority
                  CHECK (priority IN ('LOW', 'MEDIUM', 'HIGH', 'CRITICAL'));

              DROP TYPE IF EXISTS user_role_enum;
              DROP TYPE IF EXISTS project_status_enum;
              DROP TYPE IF EXISTS project_member_role_enum;
              DROP TYPE IF EXISTS task_status_enum;
              DROP TYPE IF EXISTS task_priority_enum;