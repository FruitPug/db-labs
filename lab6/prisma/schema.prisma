generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model authors {
  author_id    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String         @db.VarChar(100)
  book_authors book_authors[]
}

model book_authors {
  book_id   String  @db.Uuid
  author_id String  @db.Uuid
  authors   authors @relation(fields: [author_id], references: [author_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ba_author")
  books     books   @relation(fields: [book_id], references: [book_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ba_book")

  @@id([book_id, author_id])
}

model book_genres {
  book_id  String @db.Uuid
  genre_id String @db.Uuid
  books    books  @relation(fields: [book_id], references: [book_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_bg_book")
  genres   genres @relation(fields: [genre_id], references: [genre_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_bg_genre")

  @@id([book_id, genre_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model books {
  book_id            String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title              String               @db.VarChar(100)
  published_year     Int?                 @db.SmallInt
  book_authors       book_authors[]
  book_genres        book_genres[]
  reviews            reviews[]
  user_book_statuses user_book_statuses[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model friendships {
  user_id                            String   @db.Uuid
  friend_id                          String   @db.Uuid
  created_at                         DateTime @default(now()) @db.Timestamp(6)
  users_friendships_friend_idTousers users    @relation("friendships_friend_idTousers", fields: [friend_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_friend_friend")
  users_friendships_user_idTousers   users    @relation("friendships_user_idTousers", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_friend_user")

  @@id([user_id, friend_id])
}

model genres {
  genre_id    String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @unique @db.VarChar(50)
  book_genres book_genres[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  review_id  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rating     Int
  comment    String?
  user_id    String   @db.Uuid
  book_id    String   @db.Uuid
  created_at DateTime @default(now()) @db.Timestamp(6)
  books      books    @relation(fields: [book_id], references: [book_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reviews_book")
  users      users    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reviews_user")
}

model user_book_statuses {
  user_id    String         @db.Uuid
  book_id    String         @db.Uuid
  status     reading_status
  created_at DateTime       @default(now()) @db.Timestamp(6)
  books      books          @relation(fields: [book_id], references: [book_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ubs_book")
  users      users          @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ubs_user")

  @@id([user_id, book_id])
}

model users {
  user_id                                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                                     String               @db.VarChar(100)
  username                                 String               @unique @db.VarChar(100)
  email                                    String               @unique @db.VarChar(100)
  password_hash                            String               @db.VarChar(150)
  role                                     user_role            @default(user)
  created_at                               DateTime             @default(now()) @db.Timestamp(6)
  friendships_friendships_friend_idTousers friendships[]        @relation("friendships_friend_idTousers")
  friendships_friendships_user_idTousers   friendships[]        @relation("friendships_user_idTousers")
  reviews                                  reviews[]
  user_book_statuses                       user_book_statuses[]
  user_profiles                            user_profiles[]
}

model user_profiles {
  id      String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id String  @db.Uuid
  bio     String? @db.VarChar(150)
  users   users   @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ubs_user")
}

enum reading_status {
  reading
  planning
  finished
  dropped
  on_hold  @map("on-hold")
}

enum user_role {
  user
  admin
}
